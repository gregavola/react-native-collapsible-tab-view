{"version":3,"names":["Lazy","children","cancelLazyFadeIn","startMounted","_startMounted","mountDelayMs","name","focusedTab","refMap","didTriggerLayout","canMount","setCanMount","React","useState","isSelfMounted","useRef","shouldStartMounted","value","initialOpacity","opacity","useEffect","current","startMountTimer","useCallback","setTimeout","focused","wasFocused","scrollTo","ref","isMounted","wasMounted","stylez","onLayout","styles","container","undefined","StyleSheet","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React, { useCallback } from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  /**\n   * Whether to cancel the lazy fade in animation. Defaults to false.\n   */\n  cancelLazyFadeIn?: boolean\n  /**\n   * How long to wait before mounting the children.\n   */\n  mountDelayMs?: number\n  /**\n   * Whether to start mounted. Defaults to true if we are the focused tab.\n   */\n  startMounted?: boolean\n  children: React.ReactElement\n}> = ({\n  children,\n  cancelLazyFadeIn,\n  startMounted: _startMounted,\n  mountDelayMs = 50,\n}) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap } = useTabsContext()\n\n  /**\n   * We keep track of whether a layout has been triggered\n   */\n  const didTriggerLayout = useSharedValue(false)\n\n  /**\n   * This is used to control when children are mounted\n   */\n  const [canMount, setCanMount] = React.useState(false)\n  /**\n   * Ensure we don't mount after the component has been unmounted\n   */\n  const isSelfMounted = React.useRef(true)\n\n  /**\n   * We start mounted if we are the focused tab, or if props.startMounted is true.\n   */\n  const shouldStartMounted =\n    typeof _startMounted === 'boolean'\n      ? _startMounted\n      : focusedTab.value === name\n  let initialOpacity = 1\n  if (!cancelLazyFadeIn && !shouldStartMounted) {\n    initialOpacity = 0\n  }\n  const opacity = useSharedValue(initialOpacity)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const startMountTimer = React.useCallback(\n    (focusedTab: string) => {\n      // wait the scene to be at least mountDelay ms focused, before mounting\n      setTimeout(() => {\n        if (focusedTab === name) {\n          if (isSelfMounted.current) setCanMount(true)\n        }\n      }, mountDelayMs)\n    },\n    [mountDelayMs, name]\n  )\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused, wasFocused) => {\n      if (focused && !wasFocused && !canMount) {\n        if (cancelLazyFadeIn) {\n          opacity.value = 1\n          runOnJS(setCanMount)(true)\n        } else {\n          runOnJS(startMountTimer)(focusedTab.value)\n        }\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useAnimatedReaction(\n    () => {\n      return didTriggerLayout.value\n    },\n    (isMounted, wasMounted) => {\n      if (isMounted && !wasMounted) {\n        if (!cancelLazyFadeIn && opacity.value !== 1) {\n          opacity.value = withTiming(1)\n        }\n      }\n    },\n    [ref, cancelLazyFadeIn, name, didTriggerLayout, scrollTo]\n  )\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [opacity])\n\n  const onLayout = useCallback(() => {\n    didTriggerLayout.value = true\n  }, [didTriggerLayout])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn ? stylez : undefined]}\n        onLayout={onLayout}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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"}