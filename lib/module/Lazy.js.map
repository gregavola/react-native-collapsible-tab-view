{"version":3,"names":["React","useCallback","StyleSheet","Animated","useSharedValue","useAnimatedReaction","runOnJS","withTiming","useAnimatedStyle","ScrollView","useScroller","useTabNameContext","useTabsContext","Lazy","children","cancelLazyFadeIn","startMounted","_startMounted","mountDelayMs","name","focusedTab","refMap","didTriggerLayout","canMount","setCanMount","useState","isSelfMounted","useRef","shouldStartMounted","value","initialOpacity","opacity","useEffect","current","startMountTimer","setTimeout","focused","wasFocused","scrollTo","ref","isMounted","wasMounted","stylez","onLayout","styles","container","undefined","create","flex"],"sources":["Lazy.tsx"],"sourcesContent":["import React, { useCallback } from 'react'\nimport { StyleSheet } from 'react-native'\nimport Animated, {\n  useSharedValue,\n  useAnimatedReaction,\n  runOnJS,\n  withTiming,\n  useAnimatedStyle,\n} from 'react-native-reanimated'\n\nimport { ScrollView } from './ScrollView'\nimport { useScroller, useTabNameContext, useTabsContext } from './hooks'\n\n/**\n * Typically used internally, but if you want to mix lazy and regular screens you can wrap the lazy ones with this component.\n */\nexport const Lazy: React.FC<{\n  /**\n   * Whether to cancel the lazy fade in animation. Defaults to false.\n   */\n  cancelLazyFadeIn?: boolean\n  /**\n   * How long to wait before mounting the children.\n   */\n  mountDelayMs?: number\n  /**\n   * Whether to start mounted. Defaults to true if we are the focused tab.\n   */\n  startMounted?: boolean\n  children: React.ReactElement\n}> = ({\n  children,\n  cancelLazyFadeIn,\n  startMounted: _startMounted,\n  mountDelayMs = 50,\n}) => {\n  const name = useTabNameContext()\n  const { focusedTab, refMap } = useTabsContext()\n\n  /**\n   * We keep track of whether a layout has been triggered\n   */\n  const didTriggerLayout = useSharedValue(false)\n\n  /**\n   * This is used to control when children are mounted\n   */\n  const [canMount, setCanMount] = React.useState(false)\n  /**\n   * Ensure we don't mount after the component has been unmounted\n   */\n  const isSelfMounted = React.useRef(true)\n\n  /**\n   * We start mounted if we are the focused tab, or if props.startMounted is true.\n   */\n  const shouldStartMounted =\n    typeof _startMounted === 'boolean'\n      ? _startMounted\n      : focusedTab.value === name\n  let initialOpacity = 1\n  if (!cancelLazyFadeIn && !shouldStartMounted) {\n    initialOpacity = 0\n  }\n  const opacity = useSharedValue(initialOpacity)\n\n  React.useEffect(() => {\n    return () => {\n      isSelfMounted.current = false\n    }\n  }, [])\n\n  const startMountTimer = React.useCallback(\n    (focusedTab: string) => {\n      // wait the scene to be at least mountDelay ms focused, before mounting\n      setTimeout(() => {\n        if (focusedTab === name) {\n          if (isSelfMounted.current) setCanMount(true)\n        }\n      }, mountDelayMs)\n    },\n    [mountDelayMs, name]\n  )\n\n  useAnimatedReaction(\n    () => {\n      return focusedTab.value === name\n    },\n    (focused, wasFocused) => {\n      if (focused && !wasFocused && !canMount) {\n        if (cancelLazyFadeIn) {\n          opacity.value = 1\n          runOnJS(setCanMount)(true)\n        } else {\n          runOnJS(startMountTimer)(focusedTab.value)\n        }\n      }\n    },\n    [canMount, focusedTab]\n  )\n\n  const scrollTo = useScroller()\n\n  const ref = name ? refMap[name] : null\n\n  useAnimatedReaction(\n    () => {\n      return didTriggerLayout.value\n    },\n    (isMounted, wasMounted) => {\n      if (isMounted && !wasMounted) {\n        if (!cancelLazyFadeIn && opacity.value !== 1) {\n          opacity.value = withTiming(1)\n        }\n      }\n    },\n    [ref, cancelLazyFadeIn, name, didTriggerLayout, scrollTo]\n  )\n\n  const stylez = useAnimatedStyle(() => {\n    return {\n      opacity: opacity.value,\n    }\n  }, [opacity])\n\n  const onLayout = useCallback(() => {\n    didTriggerLayout.value = true\n  }, [didTriggerLayout])\n\n  return canMount ? (\n    cancelLazyFadeIn ? (\n      children\n    ) : (\n      <Animated.View\n        pointerEvents=\"box-none\"\n        style={[styles.container, !cancelLazyFadeIn ? stylez : undefined]}\n        onLayout={onLayout}\n      >\n        {children}\n      </Animated.View>\n    )\n  ) : (\n    <ScrollView />\n  )\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n})\n"],"mappings":"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"}